{"version":3,"file":"catolog.js","sources":["../src/js/catolog.js","../src/main.js"],"sourcesContent":["// catalog weekly api\nimport axios from 'axios';\n\nconst api_key = '4e64f2e0a197aa7c5d1170773553320c';\n\n\nconst list = document.querySelector('.list');\nconst pagination = document.querySelector('.pagination ul');\nlet lastSearch = { input: '', year: '', isSearch: false };\n\nconst startEmpty = `<svg class=\"icon\" width=\"18\" height=\"18\">\n          <use href=\"./icons.svg#icon-star-outline\"></use>\n        </svg>`;\nconst startHalf = `<svg class=\"icon\" fill=\"#F87719\" width=\"18\" height=\"18\">\n          <use href=\"./icons.svg#icon-star-half\"></use>\n        </svg>`;\nconst startFull = `<svg class=\"icon\" fill=\"#F87719\" width=\"18\" height=\"18\">\n          <use href=\"./icons.svg#icon-star\"></use>\n        </svg>`;\n\nlet currentPage = 1;\nlet totalPages = 1;\n\nconst genreIdsToStrings = async (genreIds) => {\n    const options = {\n        method: 'GET',\n        url: 'https://api.themoviedb.org/3/genre/movie/list?language=en',\n        headers: {\n          accept: 'application/json',\n          Authorization: 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiJmMWRkMzEzNDEyYzUzMjQyYTU2Nzc5ZjVjMWIwNWJlNSIsIm5iZiI6MTc1MzY5OTE4OS4xOTcsInN1YiI6IjY4ODc1Mzc1MGU0ODE4YTk5OTUyYjQ0YiIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.H565ZjOCGF6NhGwiaRj-BAZ12tadYHWeWDarSsxXtc4'\n        }\n    };\n    try{\n        const res = await axios.request(options);\n        const genreIdList = res.data.genres;\n        const genreString =genreIds.map( ids => genreIdList.find(genreItem => ids === genreItem.id)?.name || \"undefined\").join(\" \");\n        return genreString;\n    }\n    catch{\n        return false;\n    }\n}\n\nexport const fetchWeeklyFilms = async (page = 1) => {\n    const url=`https://api.themoviedb.org/3/trending/movie/week?api_key=${api_key}&language=en-US&page=${page}`;\n    \n    try{\n      const res = await axios.get(url);\n        const filteredData = await Promise.all( res.data.results.map(async filter=> ({\n            title: filter.title || filter.name,\n            rating: Math.round(filter.vote_average),\n            genreId:await genreIdsToStrings(filter.genre_ids),\n            year: filter.release_date || filter.first_air_date,\n            id: filter.id,\n            image: filter.poster_path\n        })));\n        return {\n            filteredData,\n            total_pages: res.data.total_pages\n        };\n    }\n    catch(err){\n        return false;\n    }\n}\n\n//filtered by name and year or both\nexport const fetchSearchFilms = async (input, year = null,page) => {\n\n    const filteredUrl = year !== null ? `https://api.themoviedb.org/3/search/movie?api_key=${api_key}&query=${input}&include_adult=false&language=en-US&page=${page}&primary_release_year=${year}` :\n    `https://api.themoviedb.org/3/search/movie?api_key=${api_key}&query=${input}&include_adult=false&language=en-US&page=${page}`\n    \n\n    try{\n      const res = await axios.get(filteredUrl);\n        const filteredFilms = res.data.results.map(filter => ({\n            title: filter.title || filter.name,\n            rating: Math.round(filter.vote_average),\n            genreId: filter.genre_ids,\n            year: filter.release_date || filter.first_air_date,\n            id: filter.id,\n            image: filter.poster_path\n        }));\n        return {\n          filteredFilms,\n          total_pages: res.data.total_pages,\n        };\n    }\n    catch(err){\n        return err.data;\n    }\n        \n}\n\nexport const  renderFilms =(images)=> {\n  list.innerHTML = '';\n  const newImages = images\n    .map(({ id, title, image, year, rating, genreId }) => {\n      console.log(genreId);\n      const date = year.split('-')[0];\n      const newRating = renderRating(rating);\n      return image\n        && `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${image});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genreId} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n        ;\n    })\n    .join('');\n  list.insertAdjacentHTML('beforeend', newImages);\n}\nexport const  renderPagination =(total, current) =>{\n  pagination.innerHTML = '';\n  let html = '';\n\n  // Previous button\n  if (current > 1) {\n    html += `<li data-page=\"${current - 1}\" class=\"prev\"><</li>`;\n  }\n\n  // Page numbers (show max 5 pages around current)\n  let start = Math.max(1, current - 2);\n  let end = Math.min(total, current + 2);\n  for (let i = start; i <= end; i++) {\n    html += `<li data-page=\"${i}\" class=\"${\n      i === current ? 'active' : ''\n    }\">${i}</li>`;\n  }\n\n  // Next button\n  if (current < total) {\n    html += `<li data-page=\"${current + 1}\" class=\"next\">></li>`;\n  }\n\n  pagination.innerHTML = html;\n}\nexport const loadWeeklyFilms = async (page = 1) => {\n  try {\n    const { filteredData, total_pages } = await fetchWeeklyFilms(page);\n    totalPages = total_pages;\n    currentPage = page;\n    renderFilms(filteredData);\n    renderPagination(totalPages, currentPage);\n    lastSearch = { input: '', year: '', isSearch: false };\n  } catch (error) {\n    console.log(error);\n  }\n}\nexport const loadSearchFilms = async (input, year, page = 1)=> {\n  try {\n    const { filteredFilms, total_pages } = await fetchSearchFilms(\n      input,\n      year,\n      page\n    );\n    \n    totalPages = total_pages;\n    currentPage = page;\n    if (filteredFilms.length === 0) {\n      list.innerHTML = `<li class=\"not-found\">OOPS... We are very sorry! We donâ€™t have any results matching your search.</li>`;\n      pagination.innerHTML = '';\n      return;\n    }\n    renderFilms(filteredFilms);\n    renderPagination(totalPages, currentPage);\n    lastSearch = { input, year, isSearch: true };\n    return lastSearch;\n  } catch (error) {\n    console.log(error);\n  }\n}\nexport const renderRating = (rating) => { \n  let starts = '';\n   switch (rating) {\n     case 0:\n       starts = `${startEmpty.repeat(5)}`;\n       break;\n     case 1:\n       starts = `${startHalf}${startEmpty.repeat(4)}`;\n       break;\n     case 2:\n       starts = `${startFull}${startEmpty.repeat(4)}`;\n       break;\n     case 3:\n       starts = `${startFull}${startHalf}${startEmpty.repeat(3)}`;\n       break;\n     case 4:\n       starts = `${startFull.repeat(2)}${startEmpty.repeat(3)}`;\n       break;\n     case 5:\n       starts = `${startFull.repeat(2)}${startHalf}${startEmpty.repeat(2)}`;\n       break;\n     case 6:\n       starts = `${startFull.repeat(3)}${startEmpty.repeat(2)}`;\n       break;\n     case 7:\n       starts = `${startFull.repeat(3)}${startHalf}${startEmpty}`;\n       break;\n     case 8:\n       starts = `${startFull.repeat(4)}${startEmpty}`;\n       break;\n     case 9:\n       starts = `${startFull.repeat(4)}${startHalf}`;\n       break;\n     case 10:\n       starts = `${startFull.repeat(5)}`;\n       break;\n     default:\n       throw new Error('Invalid rating');\n  }\n  return `<div>${starts}</div>`;\n}\n\n\n","import './js/header.js';\nimport axios from 'axios';\nimport modalUi from './js/modal.js';\nimport {\n  loadWeeklyFilms,\n  loadSearchFilms,\n} from './js/catolog.js';\n\nconst form = document.getElementById('catolog-form');\nconst list = document.querySelector('.list');\nconst pagination = document.querySelector('.pagination ul');\n\nconst api_key = '4e64f2e0a197aa7c5d1170773553320c';\n\n\nlet lastSearch = { input: '', year: '', isSearch: false };\n\nform.addEventListener('submit', async e => {\n  e.preventDefault();\n  const input = e.target.elements.input.value;\n  const year = e.target.elements.choose.value;\n  if (input === \"\") {\n    list.innerHTML = `<li class=\"not-found\">Please enter a search term.</li>`;\n    pagination.innerHTML = '';\n    lastSearch = { input: '', year: '', isSearch: false };\n    return;\n  }\n  const newLastSearch = await loadSearchFilms(input, year, 1);\n  lastSearch.isSearch = newLastSearch.isSearch;\n  lastSearch.input = newLastSearch.input;\n  lastSearch.year = newLastSearch.year;\n  form.reset();\n});\n\npagination.addEventListener('click', async e => {\n  if (e.target.tagName === 'LI' && e.target.dataset.page) {\n    const page = Number(e.target.dataset.page);\n    if (lastSearch.isSearch) {\n      \n      await loadSearchFilms(lastSearch.input, lastSearch.year, page);\n    } else {\n      await loadWeeklyFilms(page);\n    }\n  }\n});\n\nlist.addEventListener('click', async e => {\n  if (e.target.nodeName === 'LI') {\n    const id = e.target.id;\n    try {\n      const response = await axios.get(\n        `https://api.themoviedb.org/3/movie/${id}?api_key=${api_key}&language=en-US`\n      );\n      modalUi(response.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n});\n\n// Initial load\nloadWeeklyFilms();\n"],"names":["api_key","list","pagination","lastSearch","startEmpty","startHalf","startFull","currentPage","totalPages","genreIdsToStrings","genreIds","options","genreIdList","axios","ids","_a","genreItem","fetchWeeklyFilms","page","url","res","filter","fetchSearchFilms","input","year","filteredUrl","err","renderFilms","images","newImages","id","title","image","rating","genreId","date","newRating","renderRating","renderPagination","total","current","html","start","end","loadWeeklyFilms","filteredData","total_pages","error","loadSearchFilms","filteredFilms","starts","form","e","newLastSearch","response","modalUi"],"mappings":"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"}