{"version":3,"file":"library.js","sources":["../src/js/library.js"],"sourcesContent":["import axios from 'axios';\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nimport { renderRating } from './catolog.js';\n\nconst list = document.querySelector('.library-list');\nlet loadMore = document.querySelector('.load-more');\n\nconst api_key = '4e64f2e0a197aa7c5d1170773553320c';\n\nfunction getLocalStorageFilms() {\n  return JSON.parse(localStorage.getItem('movies')) || [];\n}\nlet startIndex = 0;\nconst endIndex = 9;\n\ndocument.getElementById(\"category\").onchange = function (e) {\n  list.innerHTML = \"\"\n  const films = getLocalStorageFilms()\n\n  const category = e.target.value\n\n  const newFilms = []\n\n  films.forEach(film => {\n    if (film.genres.split(\",\").includes(category)) {\n      newFilms.push(film)\n    }\n  })\n  if (newFilms.length <= 9) {\n    loadMore.style.display = 'none';\n    renderFilmsLibrary(newFilms);\n  } else {\n    \n    startIndex = 0;\n    const initialFilms = newFilms.slice(startIndex, endIndex);\n    renderFilmsLibrary(initialFilms);\n    \n\n    // Remove previous event listeners to prevent stacking\n    const newLoadMore = loadMore.cloneNode(true);\n    loadMore.parentNode.replaceChild(newLoadMore, loadMore);\n    loadMore = document.querySelector('.load-more');\n    loadMore.style.display = 'block';\n\n    loadMore.addEventListener('click', () => {\n      startIndex += 9;\n      const nextFilms = newFilms.slice(startIndex, startIndex + endIndex);\n\n      if (nextFilms.length === 0) {\n        loadMore.style.display = 'none';\n        return;\n      }\n\n      renderFilmsLibrary(nextFilms);\n\n      if (startIndex + endIndex >= newFilms.length) {\n        loadMore.style.display = 'none';\n      }\n    });\n  }\n}\n\nfunction renderLibrary() {\n  const films = getLocalStorageFilms();\n  if (films.length === 0) {\n    list.innerHTML = `<li class=\"empty-library\">OOPS... We are very sorry! You donâ€™t have any movies at your library.. <a href=\"./catolog.html\" class=\"started\">Get Started</a></li>\n      \n    `;\n    return;\n  }\n  if (films.length <= 9) {\n    loadMore.style.display = 'none';\n    renderFilmsLibrary(films);\n  } else {\n    let startIndex = 0;\n    const endIndex = 9;\n    const initialFilms = films.slice(startIndex, endIndex);\n    renderFilmsLibrary(initialFilms);\n    loadMore.style.display = 'block';\n    loadMore.addEventListener('click', () => {\n      startIndex += 9;\n      const nextFilms = films.slice(startIndex, startIndex + endIndex);\n\n      if (nextFilms.length === 0) {\n        loadMore.style.display = 'none';\n        return;\n      }\n\n      renderFilmsLibrary(nextFilms);\n\n      if (startIndex + endIndex >= films.length) {\n        loadMore.style.display = 'none';\n      }\n    });\n  }\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const currentPage = window.location.pathname.split('/').pop() || 'index.html';\n  const navLinks = document.querySelectorAll('.nav-link');\n\n  navLinks.forEach(link => {\n    const linkHref = link.getAttribute('href').split('/').pop();\n\n    if (currentPage === linkHref) {\n      link.classList.add('active');\n    } else {\n      link.classList.remove('active');\n    }\n  });\n});\n\nconst renderFilmsLibrary = images => {\n  \n  const newImages = images\n    .map(({ id, title, poster_path, year, vote_average, genres }) => {\n      const date = year.split('-')[0];\n      const newRating = renderRating(Math.floor(vote_average));\n      return (\n        poster_path &&\n        `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${poster_path});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genres} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n      );\n    })\n    .join('');\n  list.insertAdjacentHTML('beforeend', newImages);\n};\nlist.addEventListener('click', async e => {\n  if (e.target.nodeName === 'LI') {\n    const id = e.target.id;\n    try {\n      const response = await axios.get(\n        `https://api.themoviedb.org/3/movie/${id}?api_key=${api_key}&language=en-US`\n      );\n      modalUi(response.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n});\n\nrenderLibrary();\n\nconst modalUi = movie => {\n  const instance = basicLightbox.create(`\n            <form id=\"movie-form\">\n            <p class=\"close\">&#10006;</p>\n              <img src=\"https://image.tmdb.org/t/p/w500/${\n                movie.poster_path\n              }\" alt=\"${movie.title}\">\n              <div>\n                <h2>${movie.title.toUpperCase()}</h2>\n                <table>\n                    <thead>\n                        <tr>\n                            <th>Vote/Votes</th>\n                            <td><span class=\"vote\">${Math.round(\n                              movie.vote_average\n                            )}</span> / <span class=\"vote\">${\n    movie.vote_count\n  }</span></td>\n                        </tr>\n                        \n                    </thead>\n                    <tbody>\n                        <tr>\n                            <th>Popularity</th>\n                            <td>${movie.popularity}</td>\n                        </tr>\n                        <tr>\n                            <th>Genre</th>\n                            <td>${movie.genres\n                              .map(genre => genre.name)\n                              .join(' ')}</td>\n                        </tr>\n                    </tbody>\n                </table>\n              <h3>ABOUT</h3>\n              <p class=\"modal-info\">${movie.overview}</p>\n              <button class=\"movie-submit\" type=\"submit\">Remove From My Library</button>\n              </div>\n            </form>\n          `);\n  instance.show();\n  const closeButton = document.querySelector('.close');\n  closeButton.addEventListener('click', () => {\n    instance.close();\n  });\n  document.addEventListener('keyup', function (e) {\n    if (e.code === 'Escape') {\n      instance.close();\n    }\n  });\n  const movieForm = document.getElementById('movie-form');\n\n  movieForm.addEventListener('submit', e => {\n    e.preventDefault();\n\n    const movies = getLocalStorageFilms();\n    const updatedMovies = movies.filter(movieItem => movieItem.id !== movie.id);\n    localStorage.setItem('movies', JSON.stringify(updatedMovies));\n\n    const newMovies = updatedMovies\n      .map(({ id, title, poster_path, year, vote_average, genres }) => {\n        const date = year.split('-')[0];\n        const newRating = renderRating(Math.floor(vote_average));\n        return (\n          poster_path &&\n          `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${poster_path});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genres} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n        );\n      })\n      .join('');\n\n    list.innerHTML = newMovies;\n    instance.close();\n  });\n};\n"],"names":["list","loadMore","api_key","getLocalStorageFilms","startIndex","endIndex","films","category","newFilms","film","renderFilmsLibrary","initialFilms","newLoadMore","nextFilms","renderLibrary","currentPage","link","linkHref","images","newImages","id","title","poster_path","year","vote_average","genres","date","newRating","renderRating","response","axios","modalUi","error","movie","instance","basicLightbox.create","genre","e","updatedMovies","movieItem","newMovies"],"mappings":"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"}