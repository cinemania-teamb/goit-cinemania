{"version":3,"file":"library.js","sources":["../src/js/library.js","../src/js/eventBus.js"],"sourcesContent":["import axios from 'axios';\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nimport { renderRating } from \"./catolog.js\";\n\n\nconst list = document.querySelector('.library-list');\nconst loadMore = document.querySelector('.load-more');\n\nconst api_key = '4e64f2e0a197aa7c5d1170773553320c';\n\nfunction getLocalStorageFilms() {\n  return JSON.parse(localStorage.getItem('movies')) || [];\n}\nlet startIndex = 0;\nconst endIndex = 9;\n\n\n\nfunction renderLibrary(){\n  const films = getLocalStorageFilms();\n  if (films.length === 0) {\n    list.innerHTML = `<li class=\"empty-library\">OOPS... We are very sorry! You donâ€™t have any movies at your library..</li>`;\n    return;\n  }\n  if (films.length <= 9) {\n    loadMore.style.display = 'none';\n    renderFilmsLibrary(films);\n  } else {\n    const initialFilms = films.slice(startIndex, endIndex);\n    renderFilmsLibrary(initialFilms);\n    loadMore.style.display = 'block';\n    loadMore.addEventListener('click', () => { \n\n      startIndex += 9;\n      const nextFilms = films.slice(startIndex, startIndex + endIndex);\n      \n      if (nextFilms.length === 0) {\n        loadMore.style.display = 'none';\n        return;\n      }\n      \n      renderFilmsLibrary(nextFilms);\n      \n      if (startIndex + endIndex >= films.length) {\n        loadMore.style.display = 'none';\n      }\n    })\n  }\n  \n  \n};\n\n\nconst  renderFilmsLibrary =(images)=> {\n  const newImages = images\n    .map(({ id, title, poster_path, year, vote_average, genres }) => {\n      const date = year.split('-')[0];\n      const newRating = renderRating(Math.floor(vote_average));\n      return (\n        poster_path &&\n        `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${poster_path});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genres} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n      );\n    })\n    .join('');\n  list.insertAdjacentHTML('beforeend', newImages);\n}\nlist.addEventListener('click', async (e) => { \n  if(e.target.nodeName === 'LI') {\n     const id = e.target.id;\n    try {\n      const response = await axios.get(\n        `https://api.themoviedb.org/3/movie/${id}?api_key=${api_key}&language=en-US`\n      );\n      modalUi(response.data);\n    } catch (error) {\n      console.log(error);\n    }\n  }\n});\n\n\nrenderLibrary();\n\n\nconst modalUi = movie => {\n  const instance = basicLightbox.create(`\n            <form id=\"movie-form\">\n            <p class=\"close\">&#10006;</p>\n              <img src=\"https://image.tmdb.org/t/p/w500/${\n                movie.poster_path\n              }\" alt=\"${movie.title}\">\n              <div>\n                <h2>${movie.title.toUpperCase()}</h2>\n                <table>\n                    <thead>\n                        <tr>\n                            <th>Vote/Votes</th>\n                            <td><span class=\"vote\">${Math.round(movie.vote_average)}</span> / <span class=\"vote\">${movie.vote_count}</span></td>\n                        </tr>\n                        \n                    </thead>\n                    <tbody>\n                        <tr>\n                            <th>Popularity</th>\n                            <td>${movie.popularity}</td>\n                        </tr>\n                        <tr>\n                            <th>Genre</th>\n                            <td>${movie.genres\n                              .map(genre => genre.name)\n                              .join(' ')}</td>\n                        </tr>\n                    </tbody>\n                </table>\n              <h3>ABOUT</h3>\n              <p class=\"modal-info\">${movie.overview}</p>\n              <button class=\"movie-submit\" type=\"submit\">Remove From My Library</button>\n              </div>\n            </form>\n          `);\n  instance.show();\n  const closeButton = document.querySelector('.close');\n  closeButton.addEventListener('click', () => {\n    instance.close();\n  });\n  document.addEventListener('keyup', function (e) {\n    if (e.code === 'Escape') {\n      instance.close();\n    }\n  });\n  const movieForm = document.getElementById('movie-form');\n\n  \n\n  movieForm.addEventListener('submit', e => {\n    e.preventDefault();\n    \n    const movies = getLocalStorageFilms();\n    const updatedMovies = movies.filter(movieItem => movieItem.id !== movie.id);\n    localStorage.setItem('movies', JSON.stringify(updatedMovies));\n\n    const newMovies = updatedMovies.map(({ id, title, poster_path, year, vote_average, genres }) => { \n      const date = year.split('-')[0];\n      const newRating = renderRating(Math.floor(vote_average));\n      return (\n        poster_path &&\n        `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${poster_path});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genres} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n      );\n    }).join('');\n\n    list.innerHTML = newMovies;\n    instance.close();\n    \n    \n  });\n};\n\n\n","const eventBus = new EventTarget();\nexport default eventBus;\n"],"names":["list","loadMore","api_key","getLocalStorageFilms","startIndex","endIndex","renderLibrary","films","renderFilmsLibrary","initialFilms","nextFilms","images","newImages","id","title","poster_path","year","vote_average","genres","date","newRating","renderRating","e","response","axios","modalUi","error","movie","instance","basicLightbox.create","genre","updatedMovies","movieItem","newMovies"],"mappings":"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"}