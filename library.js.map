{"version":3,"file":"library.js","sources":["../src/js/eventBus.js","../src/js/library-modal.js","../src/js/library.js"],"sourcesContent":["const eventBus = new EventTarget();\nexport default eventBus;\n","import * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nimport eventBus from './eventBus.js';\n\nconst openLibraryModal = movie => {\n  if (typeof movie.genres === 'string') {\n    movie.genres = movie.genres.split(',').map(name => ({ name: name.trim() }));\n  }\n\n  const instance = basicLightbox.create(`\n    <form id=\"movie-form\">\n      <p class=\"close\" style=\"cursor:pointer;\">&#10006;</p>\n      <img src=\"https://image.tmdb.org/t/p/w500/${movie.poster_path}\" alt=\"${\n    movie.title\n  }\" width=\"375\" height=\"478\" />\n      <div>\n        <h2>${movie.title.toUpperCase()}</h2>\n        <table>\n          <thead>\n            <tr>\n              <th>Vote/Votes</th>\n              <td><span class=\"vote\">${\n                movie.vote_average\n              }</span> / <span class=\"vote\">${movie.vote_count}</span></td>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <th>Popularity</th>\n              <td>${movie.popularity}</td>\n            </tr>\n            <tr>\n              <th>Genre</th>\n              <td>${movie.genres.map(g => g.name).join(', ')}</td>\n            </tr>\n          </tbody>\n        </table>\n        <h3>ABOUT</h3>\n        <p>${movie.overview}</p>\n        <button class=\"movie-submit\" type=\"submit\">Add to my library</button>\n      </div>\n    </form>\n  `);\n\n  instance.show();\n\n  document.querySelector('.close').addEventListener('click', () => {\n    instance.close();\n  });\n\n  const escHandler = e => {\n    if (e.key === 'Escape') {\n      instance.close();\n      document.removeEventListener('keyup', escHandler);\n    }\n  };\n  document.addEventListener('keyup', escHandler);\n\n  const movieForm = document.getElementById('movie-form');\n  const movieSubmit = document.querySelector('.movie-submit');\n\n  let movies = getLocalStorage();\n\n  if (movies.some(m => m.id === movie.id)) {\n    movieSubmit.textContent = 'Remove from my library';\n  } else {\n    movieSubmit.textContent = 'Add to my library';\n  }\n\n  movieForm.addEventListener('submit', e => {\n    e.preventDefault();\n    movies = getLocalStorage();\n\n    if (movieSubmit.textContent === 'Remove from my library') {\n      const updatedMovies = movies.filter(\n        m => String(m.id) !== String(movie.id)\n      );\n      localStorage.setItem('movies', JSON.stringify(updatedMovies));\n\n      eventBus.dispatchEvent(new CustomEvent('libraryUpdated'));\n\n      instance.close();\n      return;\n    }\n\n    movies.push({\n      id: movie.id,\n      title: movie.title,\n      poster_path: movie.poster_path,\n      overview: movie.overview,\n      vote_average: movie.vote_average,\n      vote_count: movie.vote_count,\n      popularity: movie.popularity,\n      genres: movie.genres.map(g => g.name).join(','),\n    });\n    localStorage.setItem('movies', JSON.stringify(movies));\n    movieSubmit.textContent = 'Remove from my library';\n\n    eventBus.dispatchEvent(new CustomEvent('libraryUpdated'));\n  });\n};\n\nfunction getLocalStorage() {\n  return JSON.parse(localStorage.getItem('movies')) || [];\n}\n\nexport default openLibraryModal;\n","import openLibraryModal from './library-modal.js';\nimport eventBus from './eventBus.js';\n\nconst filmList = document.querySelector('.library__gallery');\nconst emptyState = document.getElementById('empty-state');\nconst tabs = document.querySelectorAll('.tab');\n\nconst startEmpty = `<svg class=\"icon\" width=\"18\" height=\"18\">\n  <use href=\"./icons.svg#icon-star-outline\"></use>\n</svg>`;\nconst startHalf = `<svg class=\"icon\" fill=\"#F87719\" width=\"18\" height=\"18\">\n  <use href=\"./icons.svg#icon-star-half\"></use>\n</svg>`;\nconst startFull = `<svg class=\"icon\" fill=\"#F87719\" width=\"18\" height=\"18\">\n  <use href=\"./icons.svg#icon-star\"></use>\n</svg>`;\n\nfunction getLocalStorageFilms() {\n  return JSON.parse(localStorage.getItem('movies')) || [];\n}\n\nfunction renderRating(rating) {\n  const roundedRating = Math.round(rating);\n  let stars = '';\n\n  switch (roundedRating) {\n    case 0:\n      stars = `${startEmpty.repeat(5)}`;\n      break;\n    case 1:\n      stars = `${startHalf}${startEmpty.repeat(4)}`;\n      break;\n    case 2:\n      stars = `${startFull}${startEmpty.repeat(4)}`;\n      break;\n    case 3:\n      stars = `${startFull}${startHalf}${startEmpty.repeat(3)}`;\n      break;\n    case 4:\n      stars = `${startFull.repeat(2)}${startEmpty.repeat(3)}`;\n      break;\n    case 5:\n      stars = `${startFull.repeat(2)}${startHalf}${startEmpty.repeat(2)}`;\n      break;\n    case 6:\n      stars = `${startFull.repeat(3)}${startEmpty.repeat(2)}`;\n      break;\n    case 7:\n      stars = `${startFull.repeat(3)}${startHalf}${startEmpty}`;\n      break;\n    case 8:\n      stars = `${startFull.repeat(4)}${startEmpty}`;\n      break;\n    case 9:\n      stars = `${startFull.repeat(4)}${startHalf}`;\n      break;\n    case 10:\n      stars = `${startFull.repeat(5)}`;\n      break;\n    default:\n      stars = `${startEmpty.repeat(5)}`;\n  }\n\n  return `<div class=\"rating-stars\">${stars}</div>`;\n}\n\nfunction renderFilms() {\n  const films = getLocalStorageFilms();\n  filmList.innerHTML = '';\n\n  if (films.length === 0) {\n    filmList.style.display = 'none';\n    emptyState.style.display = 'block';\n    return;\n  }\n\n  filmList.style.display = 'flex';\n  emptyState.style.display = 'none';\n\n  films.forEach(film => {\n    const card = document.createElement('li');\n    card.className = 'film-card';\n    card.style.cursor = 'pointer';\n    card.setAttribute('data-id', film.id);\n\n    const stars = renderRating(film.vote_average);\n\n    card.innerHTML = `\n      <img src=\"https://image.tmdb.org/t/p/w500/${film.poster_path}\" alt=\"${film.title} poster\" />\n      <div class=\"info\">\n        <div class=\"title\">${film.title}</div>\n        <div class=\"meta\">${film.genres}</div>\n        <div class=\"desc\">${film.overview}</div>\n        <div class=\"meta\">IMDB: ${film.vote_average} (${film.vote_count} oy)</div>\n        ${stars}\n      </div>\n    `;\n\n    card.addEventListener('click', () => {\n      if (typeof film.genres === 'string') {\n        film.genres = film.genres\n          .split(',')\n          .map(name => ({ name: name.trim() }));\n      }\n      openLibraryModal(film);\n    });\n\n    filmList.appendChild(card);\n  });\n}\n\ntabs.forEach(tab => {\n  tab.addEventListener('click', () => {\n    tabs.forEach(t => t.classList.remove('active'));\n    tab.classList.add('active');\n    renderFilms();\n  });\n});\n\nrenderFilms();\n\neventBus.addEventListener('libraryUpdated', () => {\n  console.log('libraryUpdated event received â€” rendering films again');\n  renderFilms();\n});\n"],"names":["eventBus","openLibraryModal","movie","name","instance","basicLightbox.create","g","escHandler","e","movieForm","movieSubmit","movies","getLocalStorage","m","updatedMovies","filmList","emptyState","tabs","startEmpty","startHalf","startFull","getLocalStorageFilms","renderRating","rating","roundedRating","stars","renderFilms","films","film","card","tab","t"],"mappings":"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"}