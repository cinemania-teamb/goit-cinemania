{"version":3,"file":"library.js","sources":["../src/js/library.js"],"sourcesContent":["import axios from 'axios';\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\nimport { renderRating } from './catolog.js';\n\nconst list = document.querySelector('.library-list');\nconst loadMore = document.querySelector('.load-more');\nconst CATEGORY_SELECT = document.getElementById('category');\n\nconst api_key = '4e64f2e0a197aa7c5d1170773553320c';\nlet startIndex = 0;\nconst endIndex = 9;\nlet currentFilms = [];\n\nfunction getLocalStorageFilms() {\n  return JSON.parse(localStorage.getItem('movies')) || [];\n}\n\nfunction renderFilmsLibrary(images, clear = false) {\n  if (clear) list.innerHTML = '';\n  const newImages = images\n    .map(({ id, title, poster_path, year, vote_average, genres }) => {\n      const date = year.split('-')[0];\n      const newRating = renderRating(Math.floor(vote_average));\n      return (\n        poster_path &&\n        `<li id=\"${id}\" style=\"background-image: url(https://image.tmdb.org/t/p/w500/${poster_path});background-size: cover;\n      background-position: center;\n      width: 395px;\n      height: 574px;\">\n          <div class=\"info\">\n              <p>${title.toUpperCase()} <span style=\"color:#B7B7B7\">${genres} | ${date}</span></p>\n              ${newRating}\n          </div>\n      </li>`\n      );\n    })\n    .join('');\n  list.insertAdjacentHTML('beforeend', newImages);\n}\n\nfunction updateLoadMoreVisibility() {\n  if (startIndex + endIndex >= currentFilms.length) {\n    loadMore.style.display = 'none';\n  } else {\n    loadMore.style.display = 'block';\n  }\n}\n\nfunction renderLibrary(films = getLocalStorageFilms()) {\n  currentFilms = films;\n  startIndex = 0;\n  if (films.length === 0) {\n    list.innerHTML = `<li class=\"empty-library\">OOPS... We are very sorry! You donâ€™t have any movies at your library.. <a href=\"./catolog.html\" class=\"started\">Get Started</a></li>`;\n    loadMore.style.display = 'none';\n    return;\n  }\n  const initialFilms = films.slice(startIndex, endIndex);\n  renderFilmsLibrary(initialFilms, true);\n  updateLoadMoreVisibility();\n}\n\nloadMore.addEventListener('click', () => {\n  startIndex += endIndex;\n  const nextFilms = currentFilms.slice(startIndex, startIndex + endIndex);\n  renderFilmsLibrary(nextFilms);\n  updateLoadMoreVisibility();\n});\n\nCATEGORY_SELECT.onchange = function (e) {\n  const films = getLocalStorageFilms();\n  const category = e.target.value;\n  const newFilms = films.filter(film =>\n    film.genres.split(',').includes(category)\n  );\n  renderLibrary(newFilms);\n};\n\nlist.addEventListener('click', async e => {\n  const li = e.target.closest('li[id]');\n  if (!li) return;\n  const id = li.id;\n  try {\n    const response = await axios.get(\n      `https://api.themoviedb.org/3/movie/${id}?api_key=${api_key}&language=en-US`\n    );\n    modalUi(response.data);\n  } catch (error) {\n    console.log(error);\n  }\n});\n\nfunction modalUi(movie) {\n  const instance = basicLightbox.create(`\n    <form id=\"movie-form\">\n      <p class=\"close\">&#10006;</p>\n      <img src=\"https://image.tmdb.org/t/p/w500/${movie.poster_path}\" alt=\"${\n    movie.title\n  }\">\n      <div>\n        <h2>${movie.title.toUpperCase()}</h2>\n        <table>\n          <thead>\n            <tr>\n              <th>Vote/Votes</th>\n              <td><span class=\"vote\">${Math.round(\n                movie.vote_average\n              )}</span> / <span class=\"vote\">${movie.vote_count}</span></td>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n              <th>Popularity</th>\n              <td>${movie.popularity}</td>\n            </tr>\n            <tr>\n              <th>Genre</th>\n              <td>${movie.genres.map(genre => genre.name).join(' ')}</td>\n            </tr>\n          </tbody>\n        </table>\n        <h3>ABOUT</h3>\n        <p class=\"modal-info\">${movie.overview}</p>\n        <button class=\"movie-submit\" type=\"submit\">Remove From My Library</button>\n      </div>\n    </form>\n  `);\n  instance.show();\n\n  const closeButton = document.querySelector('.close');\n  closeButton.addEventListener('click', () => {\n    instance.close();\n    document.removeEventListener('keyup', escHandler);\n  });\n\n  function escHandler(e) {\n    if (e.code === 'Escape') {\n      instance.close();\n      document.removeEventListener('keyup', escHandler);\n    }\n  }\n  document.addEventListener('keyup', escHandler);\n\n  const movieForm = document.getElementById('movie-form');\n  movieForm.addEventListener('submit', e => {\n    e.preventDefault();\n    const movies = getLocalStorageFilms();\n    const updatedMovies = movies.filter(movieItem => movieItem.id !== movie.id);\n    localStorage.setItem('movies', JSON.stringify(updatedMovies));\n    renderLibrary(updatedMovies);\n    instance.close();\n    document.removeEventListener('keyup', escHandler);\n  });\n}\n\n// Highlight active nav link\ndocument.addEventListener('DOMContentLoaded', () => {\n  const currentPage = window.location.pathname.split('/').pop() || 'index.html';\n  const navLinks = document.querySelectorAll('.nav-link');\n  navLinks.forEach(link => {\n    const linkHref = link.getAttribute('href').split('/').pop();\n    if (currentPage === linkHref) {\n      link.classList.add('active');\n    } else {\n      link.classList.remove('active');\n    }\n  });\n});\n\nrenderLibrary();\n"],"names":["list","loadMore","CATEGORY_SELECT","api_key","startIndex","endIndex","currentFilms","getLocalStorageFilms","renderFilmsLibrary","images","clear","newImages","id","title","poster_path","year","vote_average","genres","date","newRating","renderRating","updateLoadMoreVisibility","renderLibrary","films","initialFilms","nextFilms","category","newFilms","film","li","response","axios","modalUi","error","movie","instance","basicLightbox.create","genre","escHandler","e","updatedMovies","movieItem","currentPage","link","linkHref"],"mappings":"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"}